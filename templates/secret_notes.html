{% extends "base.html" %}

{% block title %}Secret Notes - Hogwarts{% endblock %}

{% block content %}
<h2>Secret Notes</h2>

<div style="margin: 30px 0;">
    <h3>Share Your Thoughts</h3>
    <form method="POST" action="{{ url_for('secret_notes') }}">
        <div class="form-group">
            <label for="content">Write a secret note:</label>
            <textarea id="content" name="content" placeholder="Share your magical thoughts..." required></textarea>
        </div>
        <button type="submit" class="btn">Post Note</button>
    </form>
</div>

<div style="margin-top: 50px;">
    <h3>Recent Notes</h3>
    {% if notes %}
    <div style="margin-top: 20px;">
        {% for note in notes %}
        <div style="margin-bottom: 20px; padding: 20px; background: rgba(255, 255, 255, 0.05); border-left: 4px solid #f39c12; border-radius: 5px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                <strong style="color: #f39c12;">{{ note['author'] }}</strong>
                <span style="opacity: 0.6; font-size: 14px;">{{ note['created_at'] }}</span>
            </div>
            <!-- VULNERABLE: No XSS sanitization -->
            <div class="note-content">{{ note['content']|safe }}</div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p style="opacity: 0.6; text-align: center; margin-top: 30px;">No notes yet. Be the first to share!</p>
    {% endif %}
</div>

<div style="margin-top: 40px; padding: 20px; background: rgba(255, 255, 255, 0.05); border-radius: 10px;">
    <h3>ℹ️ About Secret Notes</h3>
    <p style="margin-top: 10px; opacity: 0.8;">
        This is a secure place for Hogwarts students and staff to share their thoughts.
        All notes are stored permanently in our database and displayed to all users.
    </p>
    <p style="margin-top: 10px; font-size: 14px; opacity: 0.6;">
        Note: HTML formatting is supported for rich text notes!
    </p>
</div>


<script>
   
    const form = document.querySelector('form');
    const textarea = document.getElementById('content');
    
    form.addEventListener('submit', function(e) {
        const content = textarea.value;
        
        
        const dangerousPatterns = ['<script', 'javascript:', 'onerror'];
        let blocked = false;
        
        for (let pattern of dangerousPatterns) {
            if (content.toLowerCase().includes(pattern.toLowerCase())) {
                
                console.warn('Potentially dangerous content detected, but proceeding anyway...');
                blocked = false; 
            }
        }
        
        if (blocked) {
            alert('Your note contains potentially harmful content.');
            e.preventDefault();
        }
    });
    
    
    console.log('Secret Notes System v1.0');
    console.log('Note: This system trusts all user input. Be careful what you post!');
    console.log('HTML tags are rendered as-is. Try posting: <b>Bold text</b>');
    console.log('Advanced tip: Check document.cookie for interesting information');
    
    // Display current cookies (helpful for attackers)
    if (document.cookie) {
        console.log('Current cookies:', document.cookie);
    }
    
    // Easter egg function for testing XSS
    function testXSS() {
        const testPayloads = [
            '<img src=x onerror="alert(\'XSS\')">',
            '<svg onload="alert(\'XSS\')">',
            '<iframe src="javascript:alert(\'XSS\')">',
            '<body onload="alert(\'XSS\')">'
        ];
        console.log('XSS Test Payloads:', testPayloads);
    }
</script>
{% endblock %}

