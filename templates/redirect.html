{% extends "base.html" %}

{% block title %}Redirecting - Hogwarts{% endblock %}

{% block content %}
<div style="text-align: center; padding: 50px 0;">
    <h2>ðŸŒ€ Portal Redirecting...</h2>
    <p style="margin: 30px 0; font-size: 18px; opacity: 0.8;">
        You are being magically transported to your destination.
    </p>
    
    <div style="margin: 40px 0;">
        <div style="font-size: 80px; animation: spin 2s linear infinite;">ðŸŒ€</div>
    </div>
    
    <p style="margin: 20px 0; opacity: 0.6;" id="destination">
        Destination: {{ url }}
    </p>
    
    <p style="margin: 30px 0; font-size: 14px; opacity: 0.5;">
        If you are not redirected automatically, <a href="{{ url }}" style="color: #f39c12;">click here</a>.
    </p>
</div>

<style>
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
</style>


<script>
    // VULNERABLE: URL injected directly into JavaScript
    var redirectUrl = "{{ url }}";
    
    console.log('ðŸŒ€ Magic Portal Redirect System');
    console.log('Target URL:', redirectUrl);
    console.log('Open Redirect + XSS challenge');
    console.log('Try bypassing URL validation:');
    console.log('  - javascript: protocol');
    console.log('  - data: protocol');
    console.log('  - // protocol-relative URLs');
    console.log('  - Path confusion tricks');
    
    // Auto-redirect after 3 seconds
    setTimeout(function() {
        try {
            
            window.location = redirectUrl;
        } catch(e) {
            console.error('Redirect failed:', e);
            document.getElementById('destination').innerHTML = 
                '<span style="color: #e74c3c;">Redirect failed. The destination may be invalid.</span>';
        }
    }, 3000);
    
   
    var countdown = 3;
    var countdownInterval = setInterval(function() {
        countdown--;
        if (countdown > 0) {
            document.querySelector('h2').textContent = 'ðŸŒ€ Portal Redirecting in ' + countdown + '...';
        } else {
            clearInterval(countdownInterval);
        }
    }, 1000);
</script>
{% endblock %}

